---
- name: Install 7-Zip on Windows Servers
  hosts: 192.168.0.4
  gather_facts: no
  vars:
    seven_zip_url: https://www.7-zip.org/a/7z2501-x64.msi
    seven_zip_installer_path: C:\Temp\7z2501-x64.msi

  tasks:

    - name: Ensure Temp directory exists
      win_file:
        path: C:\Temp
        state: directory

    - name: Download 7-Zip installer
      win_get_url:
        url: "{{ seven_zip_url }}"
        dest: "{{ seven_zip_installer_path }}"
        force: yes

    - name: Install 7-Zip silently
      win_command: "{{ seven_zip_installer_path }} /S"
      args:
        creates: 'C:\Program Files\7-Zip\7z.exe'
